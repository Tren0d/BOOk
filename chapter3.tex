\chapter{Processes}

In this chapter, we will consider processes. It might seem that processes and algorithms are similar topics, but the main difference is that we should construct something by ourselves, whereas in processes we can not create something new in problem, instead we can make judgements on which we have.

\section{Invariants and monovariants}

As always, we will start with invariants, and monovariants. Fortunately, the idea of invariants is a very useful approach to practically every process problem: it might be very helpful to make several observations on processes.

\begin{example} [ISL 2014]
We have $2^m$ sheets of paper, with the number $1$ written on each of them. We perform the following operation. In every step we choose two distinct sheets; if the numbers on the two sheets are $a$ and $b$, then we erase these numbers and write the number $a + b$ on both sheets. Prove that after $m2^{m -1}$ steps, the sum of the numbers on all the sheets is at least $4^m$ .
\end{example}

\sol 
Ok, this problem is felt like it can be fully cracked by invariants, so let us try to find this. The first thought that comes to mind is to consider the sum of numbers written on cards, but it is a wrong approach; rather, we should consider the product of the $2^m$ numbers, instead of the sum.

Claim: Whenever the operation is performed, the resulting product of the $2^m$ increases by at least $4$ times.

Proof: $(a+b)^2 \geq 4ab$.

Now, at the end of the $m2^{m-1}$ steps, the product will be at least $4^{m2^{m-1}} = 2^{2^m}$, so by AM-GM, the sum of the $2^m$ sheets of paper is at least $2^m \cdot 2^m = 4^m$, as desired.

\begin{example}[IMO 1986]
    To each vertex of a regular pentagon an integer is assigned, so that the sum of all five numbers is positive. If three consecutive vertices are assigned the numbers $x,y,z$ respectively, and $y<0$, then the following operation is allowed: $x,y,z$ are replaced by $x+y,-y,z+y$ respectively. This iteration is performed repeatedly as long as at least one of the five numbers is negative. Determine whether this procedure necessarily comes to an end after a finite number of steps.
\end{example}

\sol Answer: This procedure is always terminates.

First, if all our numbers on the pentagon are labeled $x_i$, all the indices have taken the undo module 5. Let in the first step $(x_1,x_2,x_3,x_4,x_5) \to (x_1,x_2+x_3,-x_3,x_4+x_3,x_5)$

We will solve this problem using monovariants. It is not hard to see that sum of all numbers written on the pentagon remains invariant. Because the sum is positive and remains invariant and at the end all numbers are also positive, this leads to the thought that pairwise differences should be small, so it can be an idea to consider pairwise differnces.  After several trials we can end with such monovariant:

$f_0(x_1,x_2,x_3,x_4,x_5)=$

$ \frac{1}{2} \sum_{i=1}^5 (x_{i+1}-x_i)^2$.

WlOG assume that $x_4<0$, and after meticulous opening brackets it is not hard to see that our quantitiy is decrasing step by step. Because: $f_{\text{new}}-f_{\text{old}}=Sx_4<0$, where $S$ is sum of all numbers in pentagon. Because our quantity is decreasing, the process terminates after finite number of steps.

In previous examples we have seen the problems related to monovariant, and of course we can solve certain algorithmical problems with invariants,

\begin{example}[All-Russian 1997]
    There are some stones placed on an infinite (in both directions) row of squares labeled by integers. (There can be more than one stone on a given square). There are two types of moves:

    \begin{itemize}
        \item Remove one stone from each of the squares $n$ and $n-1$ and place one stone on $n+1$
        \item Remove two stones from square $n$ and place one stone on each of the squares $n+1$ and $n-2$.
    \end{itemize}

    Show that at some point no more moves can be made.
\end{example}

\sol Give a stone in square $k$ weight $\varphi^k$ where $\varphi=\frac{1+\sqrt{5}}{2}$, and it is not hard to see that the sum of all weights remains invariant due to the relation $\varphi^k = \varphi^{k-1} + \varphi^{k-2}$. Suppose that the process never terminates, from which there exists at least one square that is operated on infinitely many times. Consider the square of least value that is operated on finitely many times, and note that the square to the left of it is operated on infinitely, so arbitrarily many stones build up on the former square, so it must be operated on infinitely, contradiction. Thus all squares are operated on infinitely, so the index of the rightmost square that contains a stone grows arbitrarily large. At some point, the weight of the stone in that square exceeds the initial total weight, contradicting the invariant.

\begin{example}

\end{example}

\section{Induction}

\begin{example}

\end{example}



\section{Chip firing}

Here we will introduce with a tough topic from "adult" mathematics. Despite this fact, many problem proposers assumed that it is a good idea to give such problems on school Olympiads. As usual, we will start with easy, demonstrative example. 

\begin{example}[ISL 1994]
    $1994$ girls are seated in a circle. Initially one girl is given $n$ coins. In one move, each girl with at least 2 coins passes one coin to each of her two neighbors. 

    \begin{itemize}
        \item[a] Show that if $n<1994$, the game must terminate.
        \item[b] Show that if $n=1994$, the game cannot terminate.
    \end{itemize}
\end{example}

\sol 
Solution for part a): Okay, the problem statement looks very familiar, for example at APMO 1997 we have faced with similar problem. As usual let's label the girls $G_1, G_2, \dots, G_{1994}$ all indices under modulo 1994.

Suppose that the game does not terminate. Then some girl must pass coins infinitely times. If some girl passes only finitely many times, there exist two adjacent girls, one of whom has passed finitely many times and one of whom has passed infinitely many times. The girl who has passed finitely many times will then accumulate coins indefinitely after her final pass, which is impossible. Hence,every girl must pass coins infinitely many times. 
\\\\
Now the key idea is the following: For any two neighboring girls $G_i$ and $G_{i+1}$, let $c_i$ be the first coin ever passed between them. After this, we may assume that $c_i$ always stays stuck between $G_i$ and $G_{i+1}$, because whenever one of them has $c_i$ and makes a move, we can assume that the coin passed to the other girl was $c_i$. Therefore, each coin is eventually stuck between two girls. Since there are fewer than $1994$ coins, this means that there exist two adjacent girls who have never passed a coin to each other. This contradicts the result of the first paragraph.
\\\\
Solution for part b) This is simple using invariants. Let a coin with girl $i$ have weight $i$, and let $G_1$ initially have all the coins. In each pass from $G_i$to her neighbors, the total weight either does not change or changes by $\pm 1994$ (if $G_1$ passes to $G_{1994}$ or vice versa). So, the total weight is invariant $\pmod{1994}$. The initial weight is $1994$, so the weight will always be divisible by $1994$. If the game terminates, then each girl has one coin, so the final weight is $1+2+3+\dots+1994 = \frac{1994\cdot1995}{2}$ which is not divisible by $1994$ -- contradiction.

\\\\

For the experienced combinatorics solver the problem might seem cropped. Definitely, there exists generalization of this problem: what if graph is not a mere cycle, but an arbitrary, connected graph? Or what if the graph is disconnected? Now, we will provide a generalized version of problem:

\begin{example}
Let us fix a connected graph \( G \) with $n$ nodes and $m$ edges,
and let us have N chips (without loops or multiple edges) on node set \( 1, \dots, n \), and start by putting \( a_i \) chips on node \( i \), \( i = 1, \dots, n \). So \( a \in \mathbb{Z}^n_+ \) and \( \sum_i a_i = N \). Recall that firing the node \( i \) means that we decrease \( a_i \) by the degree \( \text{deg}(i) \) of node \( i \), and increase \( a_j \) by 1 for each neighbor \( j \) of \( i \).  Which chip firing games are infinite and which are finite?.
\end{example}

\sol 

\begin{itemize}
    \item[a] If $N > 2m - n$ then the game is infinite.
    \item[b] If $m \leq N \leq 2m - n$ then there exists an initial configuration guaranteeing finite termination and also one guaranteeing infinite game.
    \item[c] If $N < m$ then the game is finite
\end{itemize}

\begin{proof}
It is obvious that if $N > 2m-n$ then the game cannot terminate: there is always a node $v$ with at least $\deg(v)$ chips on it. It is also obvious that if $N \leq 2m-n$ then we can place at most $\deg(v)-1$ chips on each node $v$, and so there are configurations with no legal move.
\\\\
Next we show that if the number of chips is at least $m$ then there is an initial configuration that leads to an infinite game. Clearly it suffices to show this for $N=m$. Consider any acyclic orientation of $G$, and let $\deg^+(v)$ denote the out-degree of node $v$. Let us place $\deg^+(v)$ chips on each node $v$; this is clearly possible since there are $m$ chips altogether. We claim that this game is infinite.
\\\\
Observe first that there must exist a node that can be fired in the first step. In fact, the orientation is acyclic, which implies that there is a source, i.e., a node $v$ with $\deg(v) = \deg^+(v)$. Now fire this node, and observe that the resulting distribution of chips can also be obtained from an orientation: if we reverse the edges incident with $v$, we decrease the outdegree of $v$ by $\deg^+(v)$, and increase the outdegree of each of its neighbors by $1$. Since reversing the edges incident with a source does not create any directed cycle, we can find a source in the resulting digraph which can again be fired, etc.

The proof of (c) is motivated by the previous construction. Consider any distribution of $N < m$ chips on the nodes; let $f(v)$ denote the number of chips on node $v$. Also consider an acyclic orientation of the graph $G$ and the quantity
\[
T = \sum_{v \in V(G)} \max \{ 0, f(v) - \deg^+(v) \}.
\]

We say that a node $u$ is \emph{deficient} if $f(u) < \deg^+(u)$; by our hypothesis that $N < m$, there must exist a deficient node. We are going to show that we can modify the orientation during the game so that $T$ never increases and if the set of deficient nodes changes then $T$ must actually decrease. If the game is infinite then every node gets fired infinitely often, and hence the set of deficient nodes must change infinitely often (since a deficient node cannot be fired). Since $T$ cannot decrease infinitely often, this implies that the game is finite.

Consider the node $v$ that is first fired; we have $f(v) \geq \deg(v)$. Fire $v$ and reverse the orientation of all edges leaving $v$. We do not create any cycle. Moreover, we do not increase T since the term in T corresponding to $v$ decreases by $\deg(v) − \deg^+(v)$ while each of the $\deg(v) − \deg^+(v)$ terms corresponding to the nodes u for which $uv \in E(G)$ increases by at most 1.

Also note that if such a node u was deficient then $T$ actually decreases; if none of these was deficient then the set of deficient nodes did not change. As remarked, this proves the theorem
\end{proof}


\section{Ignore or redefine}

\begin{example}

\end{example}

\section{Graphs}

\subsection{Diamond lemma}

\begin{example}
    Pirates have an infinite number of chests, numbered in natural numbers. Initially, the first chest contains $2023$ coins. Every day, the captain selects a chest with the number $k$, in which there are at least 2 more coins than in the next one, and transfers one coin from it to the next. One of these days, the captain won't be able to find such a chest. How could the coins have been distributed at this point?
\end{example}

\section{Discrete continuity}

\begin{example}[Russia 2009]
    On a circle there are $2009$ nonnegative integers not greater than $100$. If two numbers sit next to each other, we can increase both of them by $1$. We can do this at most $ k$ times. What is the minimum $ k$ so that we can make all the numbers on the circle equal?
\end{example}

\section{Problems}

\begin{problem}[IMO 2019]
   The Bank of Bath issues coins with an $H$ on one side and a $T$ on the other. Harry has $n$ of these coins arranged in a line from left to right. He repeatedly performs the following operation: if there are exactly $k>0$ coins showing $H$, then he turns over the $k$-th coin from the left; otherwise, all coins show $T$ and he stops. \\ For example, if $n=3$ the process starting with the configuration $THT$ would be $THT \to HHT \to HTT \to TTT$, which stops after three operations. \\ Show that, for each initial configuration, Harry stops after a finite number of operations.
\end{problem}

\begin{problem}[IMO 2022]
    The Bank of Oslo issues two types of coin: aluminum (denoted A) and bronze (denoted B). Marianne has $n$ aluminum coins and $n$ bronze coins arranged in a row in some arbitrary initial order. A chain is any subsequence of consecutive coins of the same type. Given a fixed positive integer $k \leq 2n$, Gilberty repeatedly performs the following operation: he identifies the longest chain containing the $k^{th}$ coin from the left and moves all coins in that chain to the left end of the row. For example, if $n=4$ and $k=4$, the process starting from the ordering $AABBBABA$ would be $AABBBABA \to BBBAAABA \to AAABBBBA \to BBBBAAAA \to \dots$

    Find all pairs $(n,k)$ with $1 \leq k \leq 2n$ such that for every initial ordering, at some moment during the process, the leftmost $n$ coins will all be of the same type.
\end{problem}

\begin{problem}[APMO 2025]
    Let $n \geq 3$ be an integer. There are $n$ cells on a circle, and each cell is assigned either $0$ or $1$. There is a rooster on one of these cells, and it repeats the following operation:
    
    \begin{itemize}
        \item If the rooster is on a cell assigned $0$, it changes the assigned number to $1$ and moves to the next cell counterclockwise.
        \item If the rooster is on a cell assigned $1$, it changes the assigned number to $0$ and moves to the cell after the next cell counterclockwise.
    \end{itemize}

    Prove that the following statement holds after sufficiently many operations:

    If the rooster is on a cell $C$, then the rooster would go around the circle exactly three times, stopping again at $C$. Moreover, every cell would be assigned the same number as it was assigned right before the rooster went around the circle three times.
\end{problem}

\begin{problem} [Serbia 2022]
    On the board are written $n$ natural numbers, $n\in \NN$. In one move it is possible to choose two equal written numbers and increase one by $1$ and decrease the other by $1$. Prove that in this the game cannot be played more than $\frac{n^3}{6}$ moves.

\end{problem}

